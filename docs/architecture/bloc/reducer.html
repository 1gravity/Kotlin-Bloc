<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-architecture/bloc/reducer">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Kotlin Bloc" href="/Kotlin-Bloc/opensearch.xml"><title data-rh="true">Reducer | Kotlin Bloc</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://1gravity.github.io//Kotlin-Bloc/docs/architecture/bloc/reducer"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Reducer | Kotlin Bloc"><meta data-rh="true" name="description" content="Definition"><meta data-rh="true" property="og:description" content="Definition"><link data-rh="true" rel="icon" href="/Kotlin-Bloc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://1gravity.github.io//Kotlin-Bloc/docs/architecture/bloc/reducer"><link data-rh="true" rel="alternate" href="https://1gravity.github.io//Kotlin-Bloc/docs/architecture/bloc/reducer" hreflang="en"><link data-rh="true" rel="alternate" href="https://1gravity.github.io//Kotlin-Bloc/docs/architecture/bloc/reducer" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://R1VNVBGTR1-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Kotlin-Bloc/assets/css/styles.6dcd3491.css">
<link rel="preload" href="/Kotlin-Bloc/assets/js/runtime~main.25ca9857.js" as="script">
<link rel="preload" href="/Kotlin-Bloc/assets/js/main.afbbdbc4.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Kotlin-Bloc/"><div class="navbar__logo"><img src="/Kotlin-Bloc/img/logo.png" alt="Kotlin Bloc Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Kotlin-Bloc/img/logo.png" alt="Kotlin Bloc Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Kotlin Bloc</b></a><a class="navbar__item navbar__link" href="/Kotlin-Bloc/docs/getting_started/overview">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Kotlin-Bloc/docs/architecture">Concepts</a><a class="navbar__item navbar__link" href="/Kotlin-Bloc/docs/extensions/overview">Extensions</a><a class="navbar__item navbar__link" href="/Kotlin-Bloc/docs/examples">Examples</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/1gravity/Kotlin-Bloc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Kotlin-Bloc/docs/architecture">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Kotlin-Bloc/docs/architecture/bloc">Bloc</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Kotlin-Bloc/docs/architecture/bloc">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Kotlin-Bloc/docs/architecture/bloc/reducer">Reducer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Kotlin-Bloc/docs/architecture/bloc/thunk">Thunk</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Kotlin-Bloc/docs/architecture/bloc/initializer">Initializer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Kotlin-Bloc/docs/architecture/bloc/bloc_builder">Bloc Builder</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Kotlin-Bloc/docs/architecture/bloc/lifecycle">Lifecycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Kotlin-Bloc/docs/architecture/bloc/bloc_context">Bloc Context</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Kotlin-Bloc/docs/architecture/blocstate/bloc_state">Bloc State</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Kotlin-Bloc/docs/architecture/blocowner/bloc_owner">Bloc Owner et al.</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Kotlin-Bloc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Bloc</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Reducer</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="definition">Definition<a class="hash-link" href="#definition" title="Direct link to heading">​</a></h2><p>To reiterate:</p><blockquote><p>A reducer is a function that receives the current state and an action object, decides how to update the state if necessary, and returns the new state: (state, action) =&gt; newState<br>
<!-- -->(<a href="https://redux.js.org/tutorials/fundamentals/part-2-concepts-data-flow" target="_blank" rel="noopener noreferrer">https://redux.js.org/tutorials/fundamentals/part-2-concepts-data-flow</a>)</p></blockquote><p>While the official Redux reducer definition captures the essence, reducers in the context of <code>Kotlin Bloc</code> are a bit more complex: </p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">suspend (State, Action, CoroutineScope) -&gt; Proposal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Compared to a Redux reducer, &quot;our&quot; reducer is:</p><ol><li>suspending</li><li>takes a CoroutineScope as parameter (on top of the <code>State</code> and the <code>Action</code>)</li><li>returns a <code>Proposal</code> instead of <code>State</code></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a class="hash-link" href="#context" title="Direct link to heading">​</a></h3><p>A reducer is called with a <code>ReducerContext</code> as receiver. The context giving access to the current <code>State</code>, the <code>Action</code> that triggered the reducer&#x27;s execution and a CoroutineScope:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public data class ReducerContext&lt;State, Action&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val state: State,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val action: Action,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val coroutineScope: CoroutineScope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A typical reducer would evaluate the action and apply some transformation to the immutable state like this:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reduce {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    when (action) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        is PostLoading -&gt; state.copy(loading = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        is PostLoaded -&gt; state.copy(loading = false, post = action.result)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>CoroutineScope</code> is only used in the <a href="/Kotlin-Bloc/docs/extensions/redux/redux_motivation">Redux Extension</a>. It&#x27;s tied to the lifecycle of the bloc and will be cancelled when the bloc is destroyed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="side-effect">Side Effect<a class="hash-link" href="#side-effect" title="Direct link to heading">​</a></h3><p>A side effect is a one-off event like a navigation event, an analytics event or an event to display a toast. The idea of side effects and some of the syntax was inspired by <a href="https://github.com/genaku/Reduce" target="_blank" rel="noopener noreferrer">Reduce</a>. In <code>Reduce</code> a reducer always returns an <code>Effect</code> which is a class wrapping <code>State</code> and a list of side effects. <code>Kotlin Bloc</code>&#x27;s reducers return <code>Proposals</code> by default while <code>Effects</code> require a a bit more typing.</p><p>Default: reducer returns <code>Proposal</code>:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// reducer without side effects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">suspend (State, Action, CoroutineScope) -&gt; Proposal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Exception: reducer returns <code>Effect&lt;Proposal, SideEffect&gt;</code>:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// reducer with side effects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">suspend (State, Action, CoroutineScope) -&gt; Effect&lt;Proposal, SideEffect&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public data class Effect&lt;Proposal : Any, SideEffect : Any&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val proposal: Proposal?,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val sideEffects: List&lt;SideEffect&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since most reducers have no side effects, using that case as the default makes sense. If side effects are required, the syntax is slightly more complex:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data class State(val loading: Boolean = false, val post: Post? = null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sealed class Action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Clicked : Action()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sealed class SideEffect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Open : SideEffect()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object LogEvent : SideEffect()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fun bloc(context: BlocContext) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bloc&lt;State, Action, SideEffect, State&gt;(context, State()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // reducer without side effects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reduce&lt;Clicked&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state.copy(loading = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // reducer with two side effects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reduceAnd&lt;Clicked&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state.copy(loading = true) and Open and LogEvent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // reducer without side effects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reduceAnd&lt;Clicked&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            state.copy(loading = true).noSideEffect()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // no state reduction, only one side effect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sideEffect&lt;Clicked&gt; { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>reduceAnd</code> is the builder function to use if a reducer has side effects. The <code>and</code> operator can be used to combine state and side effects into an <code>Effect</code> instead of instantiating the object directly. <a href="https://github.com/genaku/Reduce" target="_blank" rel="noopener noreferrer">Reduce</a> uses the <code>+</code> operator instead of <code>and</code> which makes for some neat syntax but also interferes with mathematical operations.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="execution">Execution<a class="hash-link" href="#execution" title="Direct link to heading">​</a></h2><p>When an <code>Action</code> is sent to the bloc, it will determine whether there are matching thunks. If there are, it will be put into the thunk queue. If there are no matching thunks but matching reducers, the action will be put into the reducer queue. The queues are <a href="https://kotlinlang.org/docs/channels.html" target="_blank" rel="noopener noreferrer">Channels</a> which are processed asynchronously.</p><p>If there&#x27;s a matching thunk and a matching reducer, only the thunk will be executed like in this example:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">thunk&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // thunk code will be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reduce&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // reduce code won&#x27;t be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This behavior makes sense because thunks are like Redux thunk-middleware. They execute before the reducers do. They can however dispatch actions to the &quot;next&quot; thunk or reducer. In this example the reducer is called when the thunk dispatches the <code>Increment</code> action.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">thunk&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // do asynchronous thunk stuff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dispatch(Increment)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reduce&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // reduce code will be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>What happens if there are two matching reducers?</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reduce&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // will be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reduce&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // won&#x27;t be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reduce {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // won&#x27;t be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This behavior also makes sense since state must be reduced only once. Whichever matching reducer is declared first is the one being called. While the order of declaration is relevant for reducers (if they match the same action), it&#x27;s not for thunks and reducers, thunks will always be executed first.</p><p>What about side effects?</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reduce&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // will be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sideEffect&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // will also be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sideEffect&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // this one too will be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reduceAnd&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // won&#x27;t be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since &quot;pure&quot; side effects functions (<code>sideEffect { }</code> block) aren&#x27;t reducing state, they will always be executed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="concurrency">Concurrency<a class="hash-link" href="#concurrency" title="Direct link to heading">​</a></h3><p>To ensure a predictable order of execution and to make sure reducers don&#x27;t reduce &quot;stale&quot; state, they are always executed sequentially. If multiple actions are sent to the bloc, those actions will be processed in the order they were received and they won&#x27;t run in parallel. Here&#x27;s an example:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sealed class Action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Increment : Action()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Decrement : Action()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private val bloc by getOrCreate { bloc&lt;Int, Action&gt;(it, 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reduce&lt;Increment&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        delay(10000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reduce&lt;Decrement&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        delay(5000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state - 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Even if <code>Increment</code> and <code>Decrement</code> are sent in quick succession, <code>Increment</code> will always be processed first and the reducer will finish before the <code>Decrement</code> action is processed.</p><ol><li><code>Increment</code> reducer starts, waits 10 seconds and sets the counter to 2</li><li><code>Decrement</code> reducer starts, waits 5 seconds and sets the counter to 1 </li></ol><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>This behavior is true for reducers triggered by an action (Redux style) or triggered by a function (MVVM+ style) (see <a href="/Kotlin-Bloc/docs/architecture/blocowner/bloc_owner#blocowner">BlocOwner</a>). As a matter of fact, both types of reducers are sent to the same queue to be processed.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="matching">Matching<a class="hash-link" href="#matching" title="Direct link to heading">​</a></h2><p>So what&#x27;s a match?</p><p>In the case of reducers, we have a match if:</p><ol><li>a reducer doesn&#x27;t define an action explicitly (catch all reducer) </li><li>a reducer defines an action identical to the sent action (<code>KClass.isInstance</code>)</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="without-action">Without Action<a class="hash-link" href="#without-action" title="Direct link to heading">​</a></h3><p>A reducer not defining an action explicitly is like a Redux reducer, a catch-all function to process a bunch of actions typically using a when statement like this:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reduce {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    when (action) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        is Increment -&gt; state + 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        is Decrement -&gt; state - 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="with-action">With Action<a class="hash-link" href="#with-action" title="Direct link to heading">​</a></h3><p>A reducer defining an action will be executed only if the sent action matches the reducer&#x27;s action.
There are two different action types requiring a different syntax:</p><p>If an action is a <code>class</code>/<code>object</code> or <code>data class</code>, the syntax is:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reduce&lt;Increment&gt; { state + 1 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reduce&lt;Decrement&gt; { state - 1 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Action definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sealed class Action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Increment : Action()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object Decrement : Action()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If an action is an <code>enum class</code>, the syntax is:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reduce(Action.Increment) { state + 1 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reduce(Action.Decrement) { state - 1 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Action definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum class Action { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Increment, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Decrement </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-matter-of-taste">A Matter of Taste<a class="hash-link" href="#a-matter-of-taste" title="Direct link to heading">​</a></h2><p>Reducers can be catch-all reducers or they can be single-action reducers (we can also use a combination of the two). Catch-all reducers are the traditional/Redux style of writing reducers.</p><p>Catch-all reducers make sense if you want the reducer logic in one place like in this (calculator) example:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reduce {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val newState = state.resetErrors()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        when (action) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Clear -&gt; CalculatorState()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Equals -&gt; newState.equals()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Add -&gt; newState.apply(Operator.Add)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Subtract -&gt; newState.apply(Operator.Subtract)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Multiply -&gt; newState.apply(Operator.Multiply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Divide -&gt; newState.apply(Operator.Divide)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PlusMinus -&gt; newState.plusMinus()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Percentage -&gt; newState.percentage()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Period -&gt; newState.period()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            is Digit -&gt; newState.digit(action.digit)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (ex: Exception) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CalculatorState.error(ex.message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using single-action reducers makes sense if the reducer logic is more complex like in this example:</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reduce&lt;Add&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    with (state.resetErrors()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runCatching {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            val state = if (register1.isNotEmpty() &amp;&amp; register2.isNotEmpty()) equals() else this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (state.register1.isEmpty())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else state.copy(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                register1 = Register(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                register2 = if (state.register1.isNotEmpty()) state.register1 else state.register2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                operator = op</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }.mapToState()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reduce&lt;Equals&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    with (state.resetErrors()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runCatching {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (register2.isEmpty()) return this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            val reg1 = when (operator) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Operator.Add -&gt; register2 + register1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Operator.Subtract -&gt; register2 - register1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Operator.Multiply -&gt; register2 * register1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Operator.Divide -&gt; register2 / register1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                else -&gt; register1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            copy(register1 = reg1, register2 = Register(), operator = null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }.mapToState()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s a &quot;matter of taste&quot;, which style you prefer. While the traditional/Redux style is to have reducers dealing with different actions, <a href="https://dev.to/feresr/a-case-against-the-mvi-architecture-pattern-1add" target="_blank" rel="noopener noreferrer">this article</a> advocates for splitting reducers into smaller chunks. </p><p><a href="https://orbit-mvi.org/" target="_blank" rel="noopener noreferrer">Orbit</a> is one of the frameworks championing the MVVM+ style (that&#x27;s what they call it in <a href="https://appmattus.medium.com/top-android-mvi-libraries-in-2021-de1afe890f27" target="_blank" rel="noopener noreferrer">this article</a>) and it served as inspiration for some of the <code>Kotlin Bloc</code> design although they take the idea one step further (see <a href="/Kotlin-Bloc/docs/architecture/blocowner/bloc_owner">BlowOwner</a>).</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Kotlin-Bloc/docs/architecture/bloc"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Kotlin-Bloc/docs/architecture/bloc/thunk"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Thunk</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#definition" class="table-of-contents__link toc-highlight">Definition</a><ul><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#side-effect" class="table-of-contents__link toc-highlight">Side Effect</a></li></ul></li><li><a href="#execution" class="table-of-contents__link toc-highlight">Execution</a><ul><li><a href="#concurrency" class="table-of-contents__link toc-highlight">Concurrency</a></li></ul></li><li><a href="#matching" class="table-of-contents__link toc-highlight">Matching</a><ul><li><a href="#without-action" class="table-of-contents__link toc-highlight">Without Action</a></li><li><a href="#with-action" class="table-of-contents__link toc-highlight">With Action</a></li></ul></li><li><a href="#a-matter-of-taste" class="table-of-contents__link toc-highlight">A Matter of Taste</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://1gravity.github.io/Kotlin-Bloc/dokka/" target="_blank" rel="noopener noreferrer" class="footer__link-item">API Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/kotlin-bloc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/1gravity/Kotlin-Bloc" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Emanuel Moecklin<br>Built with Docusaurus</div></div></div></footer></div>
<script src="/Kotlin-Bloc/assets/js/runtime~main.25ca9857.js"></script>
<script src="/Kotlin-Bloc/assets/js/main.afbbdbc4.js"></script>
</body>
</html>